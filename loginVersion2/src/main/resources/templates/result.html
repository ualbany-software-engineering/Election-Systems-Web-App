<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Result</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/home.css">
    <link rel="stylesheet" href="css/voting.css">
    <link rel="stylesheet" href="css/result.css">
  </head>
  <body onload = "decideWin();">

    <div id="header">
        <a href="results"><button id="home">Back to Results</button></a>
        <h1 id="title">Result: {Election Title}</h1>
        <div>
	        <form th:action="@{/logout}" method="post">
	       		<button>Logout</button>
	        </form>
	    </div>
    </div>

    <div id="election">
        <div id="summary">
            <p id="description">Election description</p>
            <p id="count">Total number of votes:</p>
        </div>

        <!-- 1st candidate -->
        <div id="candidate1" class="candidate won">
            <h2 class="candidate_name" id="candidate1_name">Candidate1 Name</h2>
            <img class="candidate_img" id="candidate1_img" src="imgs/candidate.jpg">
            <h3 id="candidate1_result">
                Won
            </h3>
            <h4>59%</h4>
        </div>

        <!-- 2nd candidate -->
        <div id="candidate2" class="candidate lost">
            <h2 class="candidate_name" id="candidate2_name">Candidate2 Name</h2>
            <img class="candidate_img" id="candidate2_img" src="imgs/candidate.jpg">
            <h3 id="candidate2_result">
                Lost
            </h3>
            <h4>41%</h4>
        </div>
    </div>

    <!-- footer -->
    <ul id="footer">
        <li><a href="homepage">Home</a></li>
        <li><a href="">About</a></li>
        <li><a href="adminhome">Admin Home</a></li>
        <li><a href="">Other Info</a></li>
    </ul>


	<script src="js/election.js"></script>
	<script src="js/result.js"></script>
	<script th:inline="javascript">
		var wonCandidateID = [[${wonCandidate.id}]];
		var wonCandidateName = [[${wonCandidate.name}]];
		var wonCandidateVotes = [[${wonCandidate.votes}]];
		var lostCandidateID = [[${lostCandidate.id}]];
		var lostCandidateName = [[${lostCandidate.name}]];
		var lostCandidateVotes = [[${lostCandidate.votes}]];
		var topicDescription = [[${topicInfo.description}]];
		var topicName = [[${topicInfo.name}]];

		
		
		var totalVotes = wonCandidateVotes + lostCandidateVotes
		
		var wonPercentage = Math.round(wonCandidateVotes / totalVotes * 100);
		var lostPercentage = 100 - wonPercentage;
		
		document.getElementById("description").innerHTML = topicDescription;
		document.getElementById("title").innerHTML = "Result: " + topicName;
		
		function decideWin(){
		
			if(wonCandidateVotes == lostCandidateVotes){
				setWinState(2, true, wonPercentage); setWinState(1, true, lostPercentage); 
				setTotalVotes(totalVotes);
				document.getElementById("candidate1_name").innerHTML = lostCandidateName;
				document.getElementById("candidate2_name").innerHTML = wonCandidateName;
				document.getElementById("candidate1_img").src = "imgs/" + lostCandidateName + ".jpg";
				document.getElementById("candidate2_img").src = "imgs/" + wonCandidateName + ".jpg";
				document.getElementById("candidate1_result").innerHTML = "Tie";
				document.getElementById("candidate2_result").innerHTML = "Tie";
					
			}
			else if(wonCandidateID < lostCandidateID){
				setWinState(1, true, wonPercentage); setWinState(2, false, lostPercentage); 
				setTotalVotes(totalVotes);
				document.getElementById("candidate1_name").innerHTML = wonCandidateName;
				document.getElementById("candidate2_name").innerHTML = lostCandidateName;
				document.getElementById("candidate1_img").src = "imgs/" + wonCandidateName + ".jpg";
				document.getElementById("candidate2_img").src = "imgs/" + lostCandidateName + ".jpg";
			}
			else{
				setWinState(2, true, wonPercentage); setWinState(1, false, lostPercentage); 
				setTotalVotes(totalVotes);
				document.getElementById("candidate1_name").innerHTML = lostCandidateName;
				document.getElementById("candidate2_name").innerHTML = wonCandidateName;
				document.getElementById("candidate1_img").src = "imgs/" + lostCandidateName + ".jpg";
				document.getElementById("candidate2_img").src = "imgs/" + wonCandidateName + ".jpg";
			}
		}
		
	</script>
  </body>
</html>